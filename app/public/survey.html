	<!DOCTYPE html>
<html>
<head>
	<title>Survey</title>
<!-- Jquery CDN  -->
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<!-- Bootstrap JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>
<body>

<!-- Name and Image  -->
<div class="container">
	<form name="myForm">
		<div class="input-group">
	  		<div>
		  		Name<input id="name" type="text" class="form-control" name="name">
	  		</div>
	  		<div>
		  		Image<input id="image" type="text" class="form-control" name="img">
	  		</div>
	  		<input class="submit" type="submit" name="Submit">
		</div>
	</form>
</div>
<br><br><br><br>
<!-- Questions -->
<div class="container">
	<!-- Question 1	 -->
	<div class="dropdown">Question 1
	  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
	    Select an Option
	    <span class="caret"></span>
	  </button>
	  <ul class="dropdown-menu q1" data-type='q1'>
	    <li value="1"><a href="#">Strongly Agree</a></li>
	    <li value="2"><a href="#">Agree</a></li>
	    <li value="3"><a href="#">Disagree</a></li>
	    <li value="4"><a href="#">Stronglee Disagree</a></li>
	  </ul>
	</div> <!-- End of question 1 -->
	
	<br><br><br>

	<!-- Question 2 -->
	<div class="dropdown">Question 2
	  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
	    Select an Option
	    <span class="caret"></span>
	  </button>
	  <ul  class="dropdown-menu q2" data-type="q2">
	    <li value="1"><a href="#">Strongly Agree</a></li>
	    <li value="2"><a href="#">Agree</a></li>
	    <li value="3"><a href="#">Disagree</a></li>
	    <li value="4"><a href="#">Stronglee Disagree</a></li>
	  </ul>
	</div>
</div> <!-- End of question2 -->

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        	<span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div> <!-- End of Modal -->


<!-- Capturing users chooice -->
<script type="text/javascript">
$(document).ready(function() {
		var q1 = 0;
		var q2 = 0;
		var userScore =[];
		//Replaces the default "Select option with users choice" 
		$(".dropdown-menu li a").on('click', function(){
		  $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
		});

		// gets question input value
		 $('.q1 li').on('click', function() {
		 	q1 = $(this).val();
		 });
		 $('.q2 li').on('click', function() {
		 	q2 = $(this).val();
		 });
		 
		 // When Submit button is clicked ......
			$('.submit').on('click', function(event) {
				event.preventDefault(); 
				// Validation
					let qCount = q1 + q2;
					const isName = document.forms["myForm"]["name"].value;
				    const isImg = document.forms["myForm"]["img"].value;
				    //Checks if name and image input are empty and if all questions are filled out
				    if (isName == "" || isImg == "" || qCount < 2) {
				        alert("All fields must be filled out");
				    }
				    else {
				    	// User input information
						  let personData = {
						    "name": $('#name').val().trim(),
						    "photo":$('#image').val().trim(),
						    "scores":[q1, q2]
						  }
						// Posts users name, image & score
	    				$.post('/api/friend', personData, function(data) {
					 		//Clears out name and image input 
					 		$('#name').val("");
					 		$('#image').val("");
						});
						// Holds users score
						 let userScore = [q1, q2];
						// Compares Scores
						 scoreCompare(userScore); 
				    }
			}); 
		function scoreCompare(userScore) {
			const currentURL = window.location.origin;
			let scoreArr = [];
			let sum = 0; 
			$.ajax(
			{
				url: currentURL + '/api/friend',
				method: 'GET'
			})
			.done(function(data) {
				let lowScore = 10;
				let index = 0;
				//First loop chooses the nth element in the array of people
				for(let i = 0; i < data.length - 1; i++){
					//Subtracts both scores and adds it to sum variable
					for(let j = 0; j < userScore.length; j++) {
						sum += userScore[j] - data[i].scores[j];
					}
					// Push sum to score array then resets sum to 0
					scoreArr.push(Math.abs(sum));
					sum = 0; 
				}
				//Get index of lowest number in the score arr 
				console.log(scoreArr);
				for(let i = 0; i < scoreArr.length; i++) {
					// Checks to see if the nth index of scoreArr is lower then the current low score
					if(scoreArr[i] < lowScore) {
						//Assign new low score
						lowScore = scoreArr[i];
						//Assign new index which is the current lowest score 
						index = i;
					}
				}

				modal(data, index);
				// Testing
				console.log('Low score' , lowScore);
				console.log('index' , index);
			});
		}
	function modal(data, index) {
			let matchName = data[index].name;
			let matchImg = data[index].photo;
			//Modal
			$('#myModal').modal('show');
			console.log('image:', matchImg);
			console.log('name:', matchName);
	    		var nameDiv = $('<div>');
	    		var imgDiv = $('<div>');
	    		nameDiv.text(matchName);
	    		imgDiv.text(matchImg);
	    		$('.modal-body').append(nameDiv);
	    		$('.modal-body').append(imgDiv);
	}
}); 
</script>
</body>
</html>